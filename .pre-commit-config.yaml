# Pre-commité…ç½®æ–‡ä»¶
# ä½¿ç”¨æ–¹æ³•ï¼š
#   1. å®‰è£…: pre-commit install
#   2. è¿è¡Œ: pre-commit run --all-files

repos:
  # Pythonä»£ç æ ¼å¼åŒ–å™¨ - Black
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        name: "ğŸ–¤ Black Formatter"
        language_version: python3.11
        args: [--line-length=88]

  # Pythonä»£ç æ£€æŸ¥å™¨ - Ruff (æ›¿ä»£flake8, isort, pyupgradeç­‰)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      - id: ruff
        name: "âš¡ Ruff Linter"
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format
        name: "âš¡ Ruff Formatter"

  # é€šç”¨æ–‡ä»¶æ£€æŸ¥
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # æ–‡ä»¶æ ¼å¼æ£€æŸ¥
      - id: trailing-whitespace
        name: "âœ‚ï¸  å»é™¤å°¾éšç©ºæ ¼"
      - id: end-of-file-fixer
        name: "ğŸ“„ ä¿®å¤æ–‡ä»¶æœ«å°¾"
      - id: check-yaml
        name: "ğŸ“‹ æ£€æŸ¥YAMLè¯­æ³•"
        args: [--unsafe]  # å…è®¸ä»»æ„YAMLæ ‡ç­¾
      - id: check-toml
        name: "ğŸ“‹ æ£€æŸ¥TOMLè¯­æ³•"
      - id: check-json
        name: "ğŸ“‹ æ£€æŸ¥JSONè¯­æ³•"

      # ä»£ç è´¨é‡æ£€æŸ¥
      - id: check-ast
        name: "ğŸ æ£€æŸ¥Python AST"
      - id: check-builtin-literals
        name: "ğŸ” æ£€æŸ¥å†…ç½®å­—é¢é‡"
      - id: check-case-conflict
        name: "ğŸ“‚ æ£€æŸ¥æ–‡ä»¶åå†²çª"
      - id: check-docstring-first
        name: "ğŸ“ æ£€æŸ¥æ–‡æ¡£å­—ç¬¦ä¸²ä½ç½®"
      - id: check-merge-conflict
        name: "ğŸ”€ æ£€æŸ¥åˆå¹¶å†²çª"
      - id: debug-statements
        name: "ğŸ› æ£€æŸ¥è°ƒè¯•è¯­å¥"

      # å®‰å…¨æ£€æŸ¥
      - id: check-added-large-files
        name: "ğŸ“¦ æ£€æŸ¥å¤§æ–‡ä»¶"
        args: [--maxkb=1000]
      - id: detect-private-key
        name: "ğŸ” æ£€æŸ¥ç§é’¥"

  # Pythonç±»å‹æ£€æŸ¥ - MyPy
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: "ğŸ” MyPyç±»å‹æ£€æŸ¥"
        additional_dependencies:
          - types-requests
          - types-redis
          - types-python-dateutil
        args: [--ignore-missing-imports, --show-error-codes]
        exclude: ^(migrations/|tests/|scripts/)

  # å®‰å…¨æ¼æ´æ£€æŸ¥ - Bandit
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        name: "ğŸ›¡ï¸  Banditå®‰å…¨æ£€æŸ¥"
        args: [-r, ., -x, tests/]
        exclude: ^tests/

  # ä¾èµ–å®‰å…¨æ£€æŸ¥ - Safety
  - repo: https://github.com/Lucas-C/pre-commit-hooks-safety
    rev: v1.3.2
    hooks:
      - id: python-safety-dependencies-check
        name: "ğŸ”’ ä¾èµ–å®‰å…¨æ£€æŸ¥"

  # æ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥ - pydocstyle
  - repo: https://github.com/PyCQA/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: "ğŸ“š æ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥"
        args: [--convention=google]
        exclude: ^(migrations/|tests/|scripts/)

  # Dockerfileæ£€æŸ¥
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        name: "ğŸ³ Dockerfileæ£€æŸ¥"
        args: [--ignore, DL3008, --ignore, DL3009]

  # ç¯å¢ƒå˜é‡æ£€æŸ¥
  - repo: local
    hooks:
      - id: check-env-vars
        name: "ğŸ”§ æ£€æŸ¥ç¯å¢ƒå˜é‡"
        entry: python scripts/check_env_vars.py
        language: system
        files: \.env\.example$
        pass_filenames: false

# å…¨å±€é…ç½®
default_language_version:
  python: python3.11

# CIé…ç½®
ci:
  autofix_commit_msg: |
    [pre-commit.ci] è‡ªåŠ¨ä¿®å¤ä»£ç æ ¼å¼

    [skip ci]
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit é’©å­è‡ªåŠ¨æ›´æ–°'
  autoupdate_schedule: weekly
  skip: []
  submodules: false
